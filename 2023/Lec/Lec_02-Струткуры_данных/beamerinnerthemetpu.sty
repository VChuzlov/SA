\mode<presentation>

% optional arguments are used to change the directory from which backgrounds are taken

\DeclareOptionBeamer{dk}{
	\def \TPUtitlesq {tpublack}
	\def \TPUtheme {dark}
}
\DeclareOptionBeamer{lt}{
	\def \TPUtitlesq {tpuwhite}
	\def \TPUtheme {light}
}
\DeclareOptionBeamer{ru}{
	\def \TPUlang {ru}
	\def \TPUcontacts{Контакты}
}
\DeclareOptionBeamer{en}{
	\def \TPUlang {en}
	\def \TPUcontacts{Contacts}
}

\ExecuteOptionsBeamer{lt,en}	% default is light theme and english logo
\ProcessOptionsBeamer

\setbeamertemplate{section in toc}[sections numbered]	% numbered sections in ToC
\setbeamertemplate{subsection in toc}[square]	% square labeled subsections in ToC

% text layout of slides

\setbeamertemplate{title page}
{
	\begin{tikzpicture}
	\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
  \node[text width=0.56*\the\paperwidth,anchor=south west,inner sep=0pt] at (5,0.539*\the\paperheight) {\parbox[][0.328\paperheight][b]{0.56\paperwidth}{\usebeamerfont{title}\inserttitle}};
  \node[text width=0.56*\the\paperwidth,anchor=north west,inner sep=0pt] at (5,0.475*\the\paperheight) {\parbox[][0.183\paperheight][t]{0.56\paperwidth}{\usebeamerfont{subtitle}\insertsubtitle}};
  \node[text width=0.337*\the\paperwidth,anchor=north west,inner sep=0pt] at (5,.084*\the\paperheight) {\parbox[][0.061\paperheight][t]{0.337\paperwidth}{\usebeamerfont{date in head/foot}\textcolor{tpugreen}{\insertdate}}};
  \node[text width=0.358*\the\paperwidth,anchor=north west,inner sep=0pt] at (5,.239*\the\paperheight) {\parbox[][0.13\paperheight][t]{0.358\paperwidth}{\usebeamerfont{author}\textcolor{slidenumber}{\insertauthor}}};
  \node[text width=0.358*\the\paperwidth,anchor=north west,inner sep=0pt] at (5,.195*\the\paperheight) {\parbox[][0.13\paperheight][t]{0.358\paperwidth}{\usebeamerfont{author}\textcolor{slidenumber}{\insertinstitute}}};	
\end{tikzpicture}
}

\setbeamertemplate{section page}{
\begin{tikzpicture}
	\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
	\node[text width=0.7*\the\paperwidth,anchor=north west,inner sep=0pt] at (0,0.604*\the\paperheight) {\parbox[][0.357\paperheight][c]{0.7\paperwidth}{\usebeamerfont{section}\textcolor{tpuwhite}{\insertsection}}};
\end{tikzpicture}
}

% these next few commands are made to facilitate changing backgrounds of various frames like

\newcommand{\titleframe}{	% title
  \settitlebg
  \frame{\maketitle}
  \setslidebg
}

\newcommand{\sectionframe}{	% section
  \setsecbg
  \frame{\sectionpage}
  \setslidebg
}

\newcommand{\tocframe}[1]{		% table of contents
	\settocbg
	\frame{
	\begin{tikzpicture}
	\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
	\node[anchor=west,inner sep=0pt] at (0,0.52*\the\paperheight) {\usebeamerfont{section}\textcolor{tpuwhite}{\MakeUppercase\contentsname}};
	\node[text width=0.525*\the\paperwidth,anchor=north west,inner sep=0pt] at (0.324*\the\paperwidth,0.85*\the\paperheight) {\parbox[][0.685\paperheight][t]{0.525\paperwidth}{\scriptsize \tableofcontents[#1]}};
	\end{tikzpicture}
	}
	\setslidebg
}

\newcommand{\contactsframe}[2][]{	% and contacts
	\setcontsbg
	\frame{
	\begin{tikzpicture}
	\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
	\node[anchor=south west,inner sep=0pt] at (0,0.678*\the\paperheight) {\usebeamerfont{title}\TPUcontacts};
	\node[text width=0.569*\the\paperwidth,anchor=north west,inner sep=0pt] at (0,0.604*\the\paperheight) {\parbox[][0.13\paperheight][t]{0.569\paperwidth}{\usebeamerfont{author}\insertauthor\\#2}};
	\node[text width=0.569*\the\paperwidth,anchor=north west,inner sep=0pt] at (0,0.560*\the\paperheight) {\parbox[][0.13\paperheight][t]{0.569\paperwidth}{\usebeamerfont{author}\insertinstitute}};
  \node[text width=0.569*\the\paperwidth,anchor=north west,inner sep=0pt] at (0,0.139*\the\paperheight) {\parbox[][0.13\paperheight][t]{0.569\paperwidth}{\usebeamerfont{author}\textcolor{tpuwhite}{#1}}};
	\end{tikzpicture}
	}
	\setslidebg	
}

% custom backgrounds
% feel free to use included pictures to change some of them

\newcommand{\settitlebg}{
     \setbeamertemplate{background}{
      \begin{tikzpicture}
      \useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
         \path[fill overzoom image=
         bgs/\TPUtheme/title		% title background
         ] (0,0) rectangle (\the\paperwidth,\the\paperheight);
  \fill[color=\TPUtitlesq,opacity=0.67] (0,0) rectangle (0.6375*\the\paperwidth,\the\paperheight);
  % \fill[color=extraorange] (0.6375*\the\paperwidth,0) rectangle(\the\paperwidth,0.18*\the\paperheight);
  \node[inner sep=0pt,anchor=south west] at (6.5,0.767*\the\paperheight) {\includegraphics[height=0.068\paperheight]{logos/\TPUlang/\TPUtheme/logoclr}};
  % \foreach \pos in {0,...,10} {
  	%\fill[color=tpugreen] (0.082*\the\paperwidth+0.033*\the\paperwidth*\pos,0.113*\the\paperheight) rectangle (0.082*\the\paperwidth+0.033*\the\paperwidth*\pos+0.011*\the\paperheight,0.124*\the\paperheight);
  % };
  \fill[color=tpugreen] (6.3,0.265*\the\paperheight) rectangle (7.8,0.245*\the\paperheight);
   \node[anchor=north west] at (0.517*\the\paperwidth,0.83*\the\paperheight) {\usebeamerfont{author}};
      \end{tikzpicture}
    }   
}

\newcommand{\setslidebg}{
    \setbeamertemplate{background}{
      \begin{tikzpicture}
      \useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
        \path[fill overzoom image=
        bgs/\TPUtheme/slide		% basic slide background
        ] (0,0) rectangle (\the\paperwidth,\the\paperheight);
        \node[inner sep=0pt,anchor=south west] at (0.774*\the\paperwidth,0.832*\the\paperheight) {\includegraphics[height=0.035\paperheight]{logos/\TPUlang/\TPUtheme/logobw}};
   \node[anchor=north east] at (0.962*\the\paperwidth,0.875*\the\paperheight) {\usebeamerfont{date in head/foot}\textcolor{slidenumber}{\insertframenumber{}}};
      \end{tikzpicture}
    }
}

\newcommand{\setsecbg}{
\setbeamertemplate{background}{
  \begin{tikzpicture}
      \useasboundingbox (0,0) rectangle (\the\paperwidth,\the\paperheight);
      \path[fill overzoom image=
      bgs/\TPUtheme/section	% section background
      ] (0,0) rectangle (\the\paperwidth,\the\paperheight);
      \node[inner sep=0pt,anchor=south west] at (0.082*\the\paperwidth,0.754*\the\paperheight) {\includegraphics[height=0.061\paperheight]{logos/\TPUlang/\TPUtheme/logobw}};
      \fill[color=tpugreen] (0,0.246*\the\paperheight) rectangle (0.768*\the\paperwidth,0.604*\the\paperheight);
  \end{tikzpicture}
    }
}

\newcommand{\settocbg}{
	\setbeamertemplate{background}{
	\begin{tikzpicture}
      \useasboundingbox (0,0) rectangle (\the\paperwidth,\the\paperheight);
      \path[fill overzoom image=
      bgs/\TPUtheme/toc	% ToC background
      ] (0,0) rectangle (\the\paperwidth,\the\paperheight);
      \node[inner sep=0pt,anchor=south west] at (0.082*\the\paperwidth,0.754*\the\paperheight) {\includegraphics[height=0.061\paperheight]{logos/\TPUlang/\TPUtheme/logobw}};
      \fill[color=tpugreen] (0,0.42*\the\paperheight) rectangle (0.367*\the\paperwidth,0.613*\the\paperheight);
	\end{tikzpicture}
	}
}

\newcommand{\setcontsbg}{
	\setbeamertemplate{background}{
	\begin{tikzpicture}
      \useasboundingbox (0,0) rectangle (\the\paperwidth,\the\paperheight);
      \path[fill overzoom image=
      bgs/contacts	% contacts background
      ] (0,0) rectangle (\the\paperwidth,\the\paperheight);
       \fill[color=\TPUtitlesq,opacity=0.67] (0,0) rectangle (0.6375*\the\paperwidth,\the\paperheight);
  \fill[color=tpugreen] (0,0) rectangle (0.638*\the\paperwidth,0.183*\the\paperheight);
  \node[inner sep=0pt,anchor=south west] at (0.082*\the\paperwidth,0.767*\the\paperheight) {\includegraphics[height=0.068\paperheight]{logos/\TPUlang/\TPUtheme/logoclr}};
  \fill[color=tpugreen] (0.082*\the\paperwidth,0.644*\the\paperheight) rectangle (0.162*\the\paperwidth,0.656*\the\paperheight);
	\end{tikzpicture}
	}
}

\mode
<all>
